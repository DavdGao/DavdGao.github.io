<!doctype html>







<html
  class="not-ready lg:text-base"
  style="--bg:#faf8f1"
  lang="en-us"
  dir="ltr"
><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, shrink-to-fit=no"
  />

  
  <title>Developing with MCP: A Developer&#39;s Perspective - Dawei&#39;s Homepage</title>

  
  <meta name="theme-color" />

  <meta name="description" content="As a developer working on AgentScope, a multi-agent platform. I have been integrating Model Context Protocol (MCP) servers into our library. Though impressed by the simple and elegant idea behind MCP, I encountered some practical challenges and I thought it valuable to share my experience.
My Journey with MCP
Start with a Simple Server
My journey started with a simple map service MCP server (like Google Maps) with the following basic functions:" />
  <meta name="author" content="Dawei Gao" /><link rel="preload stylesheet" as="style" href="https://davdgao.github.io/main.min.css" />

  
  <link rel="preload" as="image" href="https://davdgao.github.io/theme.png" />

  <link rel="preload" as="image" href="https://img.alicdn.com/imgextra/i1/O1CN01CYhw9S1s5WZdewuN5_!!6000000005715-0-tps-814-816.jpg" />

  <link rel="preload" as="image" href="https://davdgao.github.io/twitter.svg" /><link rel="preload" as="image" href="https://davdgao.github.io/github.svg" />

  <script
    defer
    src="https://davdgao.github.io/highlight.min.js"
    onload="hljs.initHighlightingOnLoad();"
  ></script>

  
  <link
    rel="icon"
    href="https://davdgao.github.io/favicon.ico"
  />
  <link
    rel="apple-touch-icon"
    href="https://davdgao.github.io/apple-touch-icon.png"
  />

  <meta name="generator" content="Hugo 0.147.4">
  <meta itemprop="name" content="Developing with MCP: A Developer&#39;s Perspective">
  <meta itemprop="description" content="As a developer working on AgentScope, a multi-agent platform. I have been integrating Model Context Protocol (MCP) servers into our library. Though impressed by the simple and elegant idea behind MCP, I encountered some practical challenges and I thought it valuable to share my experience.
My Journey with MCP Start with a Simple Server My journey started with a simple map service MCP server (like Google Maps) with the following basic functions:">
  <meta itemprop="datePublished" content="2025-05-21T14:43:31+08:00">
  <meta itemprop="dateModified" content="2025-05-21T14:43:31+08:00">
  <meta itemprop="wordCount" content="1186">
  <meta itemprop="keywords" content="MCP,AgentScope"><meta property="og:url" content="https://davdgao.github.io/post/mcp/">
  <meta property="og:site_name" content="Dawei&#39;s Homepage">
  <meta property="og:title" content="Developing with MCP: A Developer&#39;s Perspective">
  <meta property="og:description" content="As a developer working on AgentScope, a multi-agent platform. I have been integrating Model Context Protocol (MCP) servers into our library. Though impressed by the simple and elegant idea behind MCP, I encountered some practical challenges and I thought it valuable to share my experience.
My Journey with MCP Start with a Simple Server My journey started with a simple map service MCP server (like Google Maps) with the following basic functions:">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2025-05-21T14:43:31+08:00">
    <meta property="article:modified_time" content="2025-05-21T14:43:31+08:00">
    <meta property="article:tag" content="MCP">
    <meta property="article:tag" content="AgentScope">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Developing with MCP: A Developer&#39;s Perspective">
  <meta name="twitter:description" content="As a developer working on AgentScope, a multi-agent platform. I have been integrating Model Context Protocol (MCP) servers into our library. Though impressed by the simple and elegant idea behind MCP, I encountered some practical challenges and I thought it valuable to share my experience.
My Journey with MCP Start with a Simple Server My journey started with a simple map service MCP server (like Google Maps) with the following basic functions:">

  <link rel="canonical" href="https://davdgao.github.io/post/mcp/" />
</head>
<body
    class="bg-(--bg) text-black antialiased duration-200 ease-out [-webkit-tap-highlight-color:transparent] dark:text-white"
  ><header
  class="mx-auto flex h-[4.5rem] max-w-(--w) px-8 whitespace-nowrap lg:justify-center"
>
  <div class="relative z-50 flex items-center ltr:mr-auto rtl:ml-auto">
    <a
      class="-translate-y-[1px] text-2xl font-medium"
      href="https://davdgao.github.io/"
      >Dawei&#39;s Homepage</a
    >
    <div
      class="btn-dark text-[0px] ltr:ml-4 rtl:mr-4 h-6 w-6 shrink-0 cursor-pointer [background:url(./theme.png)_left_center/_auto_theme('spacing.6')_no-repeat] [transition:_background-position_0.4s_steps(5)] dark:[background-position:right]"
      role="button"
      aria-label="Dark"
    ></div>
  </div>

  <div
    class="btn-menu relative z-50 flex h-[4.5rem] w-[5rem] shrink-0 cursor-pointer flex-col items-center justify-center gap-2.5 lg:hidden ltr:-mr-8 rtl:-ml-8"
    role="button"
    aria-label="Menu"
  ></div>

  <script>
    
    const htmlClass = document.documentElement.classList;
    setTimeout(() => {
      htmlClass.remove('not-ready');
    }, 10);

    
    const btnMenu = document.querySelector('.btn-menu');
    btnMenu.addEventListener('click', () => {
      htmlClass.toggle('open');
    });

    
    const metaTheme = document.querySelector('meta[name="theme-color"]');
    const lightBg = '#faf8f1'.replace(/"/g, '');
    const setDark = (isDark) => {
      metaTheme.setAttribute('content', isDark ? '#000' : lightBg);
      htmlClass[isDark ? 'add' : 'remove']('dark');
      localStorage.setItem('dark', isDark);
    };

    
    const darkScheme = window.matchMedia('(prefers-color-scheme: dark)');
    if (htmlClass.contains('dark')) {
      setDark(true);
    } else {
      const darkVal = localStorage.getItem('dark');
      setDark(darkVal ? darkVal === 'true' : darkScheme.matches);
    }

    
    darkScheme.addEventListener('change', (event) => {
      setDark(event.matches);
    });

    
    const btnDark = document.querySelector('.btn-dark');
    btnDark.addEventListener('click', () => {
      setDark(localStorage.getItem('dark') !== 'true');
    });
  </script>

  <div
    class="nav-wrapper fixed inset-x-0 top-full z-40 flex h-full flex-col justify-center bg-(--bg) pb-16 duration-200 select-none lg:static lg:h-auto lg:flex-row lg:bg-transparent! lg:pb-0 lg:transition-none"
  ><nav
      class="lg:ml-12 lg:flex lg:flex-row lg:items-center lg:space-x-10 rtl:space-x-reverse"
    ><a
        class="block text-center text-xl leading-[5rem] lg:text-base lg:font-normal"
        href="/about/"
        >About Me</a
      ><a
        class="block text-center text-xl leading-[5rem] lg:text-base lg:font-normal"
        href="/publication/"
        >Publications</a
      ></nav><nav
      class="mt-12 flex justify-center space-x-10 lg:mt-0 lg:items-center ltr:lg:ml-14 rtl:space-x-reverse rtl:lg:mr-14 dark:invert"
    >
      <a
        class="h-7 w-7 text-[0px] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6"
        style="--url: url(./twitter.svg)"
        href="https://twitter.com/daweigaooooo"
        target="_blank"
        rel="me"
      >twitter</a>
      <a
        class="h-7 w-7 text-[0px] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6"
        style="--url: url(./github.svg)"
        href="https://github.com/DavdGao"
        target="_blank"
        rel="me"
      >github</a>
    </nav>
  </div>
</header>
<main
      class="prose prose-neutral dark:prose-invert relative mx-auto min-h-[calc(100vh-9rem)] max-w-(--w) px-8 pt-14 pb-16"
    ><article>
  <header class="mb-14">
    <h1 class="my-0! pb-2.5">Developing with MCP: A Developer&#39;s Perspective</h1><div class="text-xs antialiased opacity-60"><time>May 21, 2025</time><span class="mx-1">&middot;</span>
      <span>Dawei Gao</span></div></header>

  <section><p>As a developer working on <a href="https://github.com/modelscope/agentscope">AgentScope</a>, a multi-agent platform. I have been integrating Model Context Protocol (MCP) servers into our library. Though impressed by the simple and elegant idea behind MCP, I encountered some practical challenges and I thought it valuable to share my experience.</p>
<h2 id="my-journey-with-mcp">My Journey with MCP</h2>
<h3 id="start-with-a-simple-server">Start with a Simple Server</h3>
<p>My journey started with a simple map service MCP server (like Google Maps) with the following basic functions:</p>
<table>
  <thead>
      <tr>
          <th style="text-align: left">function</th>
          <th style="text-align: left">arguments</th>
          <th style="text-align: left">description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left"><code>text_around_search</code></td>
          <td style="text-align: left">keywords, location, radius</td>
          <td style="text-align: left">Search POIs around a given location with a specified radius</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>maps_text_search</code></td>
          <td style="text-align: left">keywords, city</td>
          <td style="text-align: left">Search POIs by the given keywords</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>maps_geo</code></td>
          <td style="text-align: left">address, city</td>
          <td style="text-align: left">Search location by the given structured address</td>
      </tr>
  </tbody>
</table>
<p>The test query is to find the nearest cafe around a specific location in Hangzhou, China. Easy peasy, or so I thought.</p>
<blockquote>
<p>Find the nearest cafe around Ali Cloud Valley</p></blockquote>
<p>Here&rsquo;s how my debugging journey went:</p>
<ul>
<li><strong>First Try</strong>: I started with a ReAct agent using a simple system prompt as follows. When given the query, LLM confidently used <code>text_around_search</code> with coordinates from its prior knowledge, which is incorrect of course.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>You&#39;re a helpful assistant named Friday.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># Target
</span></span><span style="display:flex;"><span>Your target is to finish the given task with the provided tools.
</span></span></code></pre></div><ul>
<li><strong>Second Try</strong>: Okay, let&rsquo;s be more specific by adding explicit instructions about coordinate handling.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>You&#39;re a helpful assistant named Friday.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># Target
</span></span><span style="display:flex;"><span>Your target is to finish the given task with the provided tools.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># Note
</span></span><span style="display:flex;"><span>1. DON&#39;T make any assumptions! All the coordinates you use should be obtained from the `map_geo`
</span></span></code></pre></div><p>Better! The LLM now used <code>maps_geo</code> first with &ldquo;Ali Cloud Valley&rdquo; as input. But still failed because <code>maps_geo</code> needs a structured address, and &ldquo;Ali Cloud Valley&rdquo; isn&rsquo;t exactly that. This highlighted the need for an intermediate step: using <code>maps_text_search</code> to get the formatted address before getting coordinates.</p>
<ul>
<li><strong>Final Solution</strong>: After identifying the key issues, I added more specific guidance in the system prompt:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>You&#39;re a helpful assistant named Friday.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># Target
</span></span><span style="display:flex;"><span>Your target is to finish the given task with the provided tools.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># Note
</span></span><span style="display:flex;"><span>1. DON&#39;T make any assumptions! All the coordinates you use should be obtained from the `map_geo`
</span></span><span style="display:flex;"><span>2. The input locations maybe not specific, so you MUST first use `maps_text_search` to get the complete and accurate address. After that, you can use `maps_geo` to get the coordinate.
</span></span><span style="display:flex;"><span>3. Sometimes, there maybe multiple locations for the same name, once you feel the search result is not accurate, you should research with different keywords or use `generate_response` function to ask for more information
</span></span></code></pre></div><p>This process reminded me of RAG (Retrieval-Augmented Generation)&rsquo;s standard operating procedure:</p>
<blockquote>
<p>Unstructured query ==&gt; Query rewrite ==&gt; Structured query ==&gt; Retrieve.</p></blockquote>
<p>It&rsquo;s unrealistic for most current LLMs to learn this SOP and execute it <strong>correctly</strong> and <strong>stable</strong> without explicit guidance.</p>
<p>However, even with this optimized prompt, I encountered new accuracy issues. Want to find sth within 500 meters? Well, the error range of some coordinate from <code>maps_geo</code> can be more than 1km. You may finally get a cafe that&rsquo;s 1.5km away, and you cannot know that in any documentation.</p>
<p>While many articles portray MCP as a &ldquo;USB interface&rdquo; for agents - suggesting a simple plug-and-play solution - the reality is more complex. Developers must still invest significant effort in debugging, understanding undocumented limitations, and implementing workarounds. In fact, for simpler functionalities, implementing direct API calls might be more straightforward than dealing with MCP&rsquo;s additional complexity.</p>
<h3 id="what-about-more-servers">What about More Servers?</h3>
<p>So far, I have built an agent with one MCP server, but what about more? The system prompt will be overwhelmed with too many instructions.</p>
<p>The first idea comes to me is &ldquo;multi-agent&rdquo;, which is actually what I&rsquo;m working on. For example, each agent holds one server and a routing agent is responsible for decomposing the task and routing sub-tasks to the corresponding agent.</p>
<p>However, this is not a good solution. I cannot guarantee that all sub-tasks can be completed with only one MCP server. Handling the communication between different agents flexibly and elegantly is also a challenge.</p>
<p>Here is my solution: <strong>allow the agent to reset its MCP servers according to the current task.</strong> When resetting the MCP servers, the corresponding tools will be equipped, and the system prompt will be updated by adding/deleting corresponding tools instructions. By this way, the agent is more flexible and powerful, and can serve as a basic agent in a more complex multi-agent system.</p>
<p>Specifically, the <code>reset_equipped_tools</code> function receives a boolean argument for each MCP server. If the argument is set to <code>True</code>, the tools in this MCP will be added to the agent, as well as the corresponding instructions.</p>
<p>The following is the signature of the <code>reset_equipped_tools</code>:</p>
<pre><code>class ReActAgentV2:
    # ...
    def reset_equipped_tools(
        self,
        gaode_map: bool = False,        # Map service server
        webpage_fetch: bool = False,    # Webpage fetching server
        webpage_deploy: bool = False,   # Webpage deployment server
        multimodal: bool = False,       # Multimodal server (text to image/audio)
    ) -&gt; ServiceResponse:
        &quot;&quot;&quot;Reset your equipped tool functions. Use this function when your 
        current tools are not enough to solve the task. Note this function is 
        not incremental, it will first disable all the current tools, and then 
        enable the new ones.
    
        Args:
            gaode_map (`bool`, defaults to `False`):
                The gaode map related tools for geography related tasks
            webpage_fetch (`bool`, defaults to `False`):
                The webpage fetching tools
            webpage_deploy (`bool`, defaults to `False`):
                The webpage deploying tools, which can be used to deploy the given webpage
            multimodal (`bool`, defaults to `False`):
                The multimodal tools, including text to image/audio tools
        &quot;&quot;&quot;
        ...
</code></pre>
<h2 id="reflections-and-concerns">Reflections and Concerns</h2>
<p>I&rsquo;m not saying MCP is bad. It&rsquo;s a great idea and has a lot of potential, but as an agent developer, integrating MCP into my code is quite challenging.</p>
<h3 id="mcp-selection">MCP Selection</h3>
<p>The challenge starts with selecting the right MCP server. Check out one MCP market, you will find</p>
<ul>
<li>Proliferation of similar servers with unclear differentiation</li>
<li>Individual servers offering multiple overlapping functions without documentation regarding function selection criteria (e.g. three functions that fetch webpage in Markdown, HTML and JSON format respectively)</li>
</ul>
<p>While flexibility is valuable, clearer guidelines on function selection and use cases would significantly improve developer experience.</p>
<h3 id="quality-control--evaluation">Quality Control &amp; Evaluation</h3>
<p>The lack of standardized quality metrics is a significant concern for both agent and MCP server developers. Currently, there&rsquo;s no reliable way to:</p>
<ul>
<li>Evaluate which server best suits specific needs and compare performance across similar servers (for agent developers)</li>
<li>Determine if a server meets minimum quality standards (for MCP developers)</li>
</ul>
<p>I know it&rsquo;s difficult to establish a universal standard for all MCP servers, but building a way for agent and MCP developers to communicate and share feedback would be a great start. Similar to mobile app stores where user feedback drives improvements and helps maintain quality standards.</p>
<h3 id="post-processing-complexity">Post-Processing Complexity</h3>
<p>When using multiple MCP servers, the <strong>inconsistent return types and formats</strong> leads to a cumbersome post-processing experience. To render the results from MCP servers in a frontend, I have to post-process their results one-by-one. Markdown, JSON, HTML, and plain text formats are all mixed together, making it a nightmare to handle.</p>
<p>At the end, all these issues significantly undermine the &ldquo;plug-and-play&rdquo; promise of MCP, often requiring substantial additional development effort to achieve consistent functionality.</p>
</section>

  <footer class="mt-12 flex flex-wrap"><a
      class="mb-1.5 rounded-lg bg-black/[3%] px-5 py-1 no-underline hover:bg-black/[6%] ltr:mr-1.5 rtl:ml-1.5 dark:bg-white/[8%] dark:hover:bg-white/[12%]"
      href="https://davdgao.github.io/tags/mcp"
      >MCP</a
    ><a
      class="mb-1.5 rounded-lg bg-black/[3%] px-5 py-1 no-underline hover:bg-black/[6%] ltr:mr-1.5 rtl:ml-1.5 dark:bg-white/[8%] dark:hover:bg-white/[12%]"
      href="https://davdgao.github.io/tags/agentscope"
      >AgentScope</a
    ></footer></article></main><footer
  class="mx-auto flex h-[4.5rem] max-w-(--w) items-center px-8 text-xs tracking-wider uppercase opacity-60"
>
  <div class="mr-auto">© 2025 DAWEI GAO</div>
  <a class="link mx-6" href="https://gohugo.io/" rel="noopener" target="_blank"
    >powered by hugo️️</a
  >️
  <a
    class="link"
    href="https://github.com/nanxiaobei/hugo-paper"
    rel="noopener"
    target="_blank"
    >hugo-paper</a
  >
</footer>
</body>
</html>
